<!DOCTYPE html>
<html>
<head>
  <!-- Meta tags dan styles tetap sama -->
</head>
<body>
  <!-- HTML structure tetap sama -->

  <script>
    // === Konfigurasi yang sama ===

    // === Fungsi Lokasi yang Ditingkatkan ===
    function getPreciseLocation() {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
          reject(new Error("Geolocation tidak didukung"));
          return;
        }

        let bestPosition = null;
        const options = {
          enableHighAccuracy: true,
          timeout: 15000,
          maximumAge: 0
        };

        const watchId = navigator.geolocation.watchPosition(
          position => {
            if (!bestPosition || position.coords.accuracy < bestPosition.coords.accuracy) {
              bestPosition = position;
            }
            
            if (position.coords.accuracy <= 20) {
              navigator.geolocation.clearWatch(watchId);
              resolve(bestPosition);
            }
          },
          error => {
            navigator.geolocation.clearWatch(watchId);
            reject(error);
          },
          options
        );

        setTimeout(() => {
          navigator.geolocation.clearWatch(watchId);
          bestPosition ? resolve(bestPosition) : reject(new Error('Waktu pencarian lokasi habis'));
        }, 30000);
      });
    }

    // === Fungsi View Location yang Ditingkatkan ===
    async function viewLocation() {
      try {
        const permission = await navigator.permissions.query({ name: 'geolocation' });
        if (permission.state === 'denied') {
          showError('Izin Lokasi Ditolak', 'Silakan aktifkan izin lokasi di pengaturan browser Anda');
          return;
        }

        const position = await getPreciseLocation();
        const { latitude, longitude, accuracy, altitude, altitudeAccuracy } = position.coords;
        
        let locationInfo = `
          <p>üõ∞Ô∏è Koordinat Presisi Tinggi:</p>
          <p><strong>${latitude.toFixed(6)}¬∞, ${longitude.toFixed(6)}¬∞</strong></p>
          <p>Akurasi: <strong>${Math.round(accuracy)} meter</strong></p>
        `;

        if (altitude) {
          locationInfo += `<p>Ketinggian: <strong>${Math.round(altitude)}m ¬±${Math.round(altitudeAccuracy)}m</strong></p>`;
        }

        const mapsUrl = `https://www.google.com/maps/search/?api=1&query=${latitude},${longitude}`;
        document.getElementById('location-info').innerHTML = `
          ${locationInfo}
          <p><a href="${mapsUrl}" target="_blank" style="color:var(--primary);">üåê Buka di Peta 3D</a></p>
          ${accuracy > 100 ? '<p class="accuracy-warning">‚ö†Ô∏è Aktifkan GPS untuk akurasi lebih baik</p>' : ''}
        `;

      } catch (error) {
        showError('Kesalahan Lokasi Kuantum', error);
      }
    }

    // === Peningkatan Analisis Perangkat ===
    async function getDeviceInfo() {
      // ... kode sebelumnya ...
      
      // Deteksi fitur GPS
      const gpsCapability = {
        hasGPS: 'geolocation' in navigator,
        motionSensors: 'DeviceOrientationEvent' in window,
        proximity: 'ProximitySensor' in window
      };

      return {
        // ... data sebelumnya ...
        sensors: gpsCapability,
        locationType: accuracy <= 100 ? 'GPS Presisi Tinggi' : 'Perkiraan Jaringan'
      };
    }

    // === Peningkatan Tampilan Error ===
    function showError(title, error) {
      let message = `${title}: ${error.message || error}`;
      if (error.code === error.PERMISSION_DENIED) {
        message += '\nüîê Izinkan akses lokasi di pengaturan browser!';
      } else if (error.code === error.TIMEOUT) {
        message += '\nüïí Aktifkan GPS dan coba lagi di area terbuka!';
      }
      
      alert(message);
      console.error(`${title}:`, error);
    }

    // === Style Tambahan ===
    const addedStyles = `
      .accuracy-warning {
        color: #e74c3c;
        margin-top: 10px;
        animation: pulse 1.5s infinite;
      }
      @keyframes pulse {
        0% { opacity: 0.6; }
        50% { opacity: 1; }
        100% { opacity: 0.6; }
      }
    `;
    document.styleSheets[0].insertRule(addedStyles);
  </script>
</body>
</html>
